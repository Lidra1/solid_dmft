

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>interface to VASP &mdash; solid_dmft  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Docker" href="docker.html" />
    <link rel="prev" title="Wannier90 interface" href="w90_interface.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #7E588A" >
          

          
            <a href="../index.html" class="icon icon-home"> solid_dmft
          

          
            
            <img src="../_static/logo_no_text.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                3.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../install.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#installation-steps">Installation steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#version-compatibility">Version compatibility</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#custom-cmake-options">Custom CMake options</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../documentation.html">documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#module-reference-manual">module reference manual</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/csc_flow.html">CSC flow module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/dft_managers.html">dft managers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/dft_managers/qe_manager.html">qe_manager.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/dft_managers/vasp_manager.html">vasp_manager.py</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/dmft_cycle.html">dmft cycle module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/dmft_tools.html">dmft tools modules</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/dmft_tools/afm_mapping.html">afm_mapping.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/dmft_tools/convergence.html">convergence.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/dmft_tools/formatter.html">formatter.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/dmft_tools/gf_mixer.html">greens_function_mixer.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/dmft_tools/initial_sigma.html">initial_self_energies.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/dmft_tools/interaction_ham.html">interaction_hamiltonian.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/dmft_tools/legendre_filter.html">legendre_filter.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/dmft_tools/manipulate_mu.html">manipulate_chemical_potential.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/dmft_tools/observables.html">observables.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/dmft_tools/results_arch.html">results_to_archive.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/dmft_tools/solver.html">solver.py</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/postprocessing.html">postprocessing tools</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/postprocessing/make_spaghetti.html">make_spaghetti.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/postprocessing/maxent_gf_imp.html">maxent_gf_imp.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/postprocessing/maxent_gf_latt.html">maxent_gf_latt.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/postprocessing/maxent_sigma.html">maxent_sigma.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/postprocessing/postproc_plotbands.html">postproc_plotbands.py</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/read_config.html">read config parser</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/read_config.html#general">general</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/read_config.html#solver">solver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/read_config.html#dft">dft</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/read_config.html#advanced">advanced</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/util.html">util</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/util/symmetrize_gamma_file.html">symmetrize_gamma_file.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/util/update_dmft_config.html">update_dmft_config.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/util/update_results_h5.html">update_results_h5.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/util/write_kslice_to_h5.html">write_kslice_to_h5.py</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="../documentation.html#dft-code-interfaces">DFT code interfaces</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="w90_interface.html">Wannier90 interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="w90_interface.html#orbital-order-in-the-w90-converter">orbital order in the W90 converter</a></li>
</ul>
</li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">interface to VASP</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#general-remarks">General remarks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#locproj-bug-for-individual-projections">LOCPROJ bug for individual projections:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#convergence-of-projectors-with-vasp">convergence of projectors with Vasp</a></li>
<li class="toctree-l4"><a class="reference internal" href="#enabling-csc-calculations-with-wannier90-projectors">Enabling CSC calculations with Wannier90 projectors</a></li>
<li class="toctree-l4"><a class="reference internal" href="#speeding-up-by-not-writing-projectors-at-every-step">Speeding up by not writing projectors at every step</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#run-solid-dmft">run solid_dmft</a><ul>
<li class="toctree-l3"><a class="reference internal" href="docker.html">Docker</a><ul>
<li class="toctree-l4"><a class="reference internal" href="docker.html#building-the-docker-image">Building the docker image</a></li>
<li class="toctree-l4"><a class="reference internal" href="docker.html#pulling-a-docker-image">Pulling a docker image</a></li>
<li class="toctree-l4"><a class="reference internal" href="docker.html#getting-docker-images-onto-cscs-daint">Getting docker images onto CSCS daint</a></li>
<li class="toctree-l4"><a class="reference internal" href="docker.html#running-a-docker-container">Running a docker container</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="run_locally.html">run on your machine</a><ul>
<li class="toctree-l4"><a class="reference internal" href="run_locally.html#csc-calculations-locally">CSC calculations locally</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="run_cluster.html">Running solid_dmft on a cluster</a><ul>
<li class="toctree-l4"><a class="reference internal" href="run_cluster.html#running-on-cscs-daint">Running on CSCS daint</a></li>
<li class="toctree-l4"><a class="reference internal" href="run_cluster.html#one-shot-job-on-daint">one shot job on daint</a></li>
<li class="toctree-l4"><a class="reference internal" href="run_cluster.html#csc-calculations-on-daint">CSC calculations on daint</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/CaFeO3_csc_plo/tutorial.html">CaFeO3 CSC with VASP PLOs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/CaFeO3_csc_plo/tutorial.html#Running-the-initial-SCF-DFT-calculation-(~-1-core-hour)">Running the initial SCF DFT calculation (~ 1 core hour)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/CaFeO3_csc_plo/tutorial.html#Input-files-for-CSC-DMFT-calculations">Input files for CSC DMFT calculations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/CaFeO3_csc_plo/tutorial.html#Running-the-CSC-DMFT-calculations">Running the CSC DMFT calculations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../issues.html">reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#version-3-0-0">Version 3.0.0</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">solid_dmft</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../documentation.html">documentation</a> &raquo;</li>
        
      <li>interface to VASP</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/md_notes/vasp_csc.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="interface-to-vasp">
<h1>interface to VASP<a class="headerlink" href="#interface-to-vasp" title="Permalink to this headline">¶</a></h1>
<div class="section" id="general-remarks">
<h2>General remarks<a class="headerlink" href="#general-remarks" title="Permalink to this headline">¶</a></h2>
<p>One can use the official Vasp 5.4.4 patch 1 version with a few modifications:</p>
<ul class="simple">
<li>there is a bug in <code class="docutils literal notranslate"><span class="pre">fileio.F</span></code> around line 1710 where the code tries print out something like “reading the density matrix from Gamma”, but this should be done only by the master node. Adding a <code class="docutils literal notranslate"><span class="pre">IF</span> <span class="pre">(IO%IU0&gt;=0)</span> <span class="pre">THEN</span> <span class="pre">...</span> <span class="pre">ENDIF</span></code> around it fixes this</li>
<li>in the current version of the dft_tools interface the file <code class="docutils literal notranslate"><span class="pre">LOCPROJ</span></code> should contain the fermi energy in the header. Therefore  one should replace the following line in <code class="docutils literal notranslate"><span class="pre">locproj.F</span></code>:</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WRITE</span><span class="p">(</span><span class="mi">99</span><span class="p">,</span><span class="s1">&#39;(4I6,&quot;  # of spin, # of k-points, # of bands, # of proj&quot; )&#39;</span><span class="p">)</span> <span class="n">NS</span><span class="p">,</span><span class="n">NK</span><span class="p">,</span><span class="n">NB</span><span class="p">,</span><span class="n">NF</span>
</pre></div>
</div>
<p>by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WRITE</span><span class="p">(</span><span class="mi">99</span><span class="p">,</span><span class="s1">&#39;(4I6,F12.7,&quot;  # of spin, # of k-points, # of bands, # of proj, Efermi&quot; )&#39;</span><span class="p">)</span> <span class="n">W</span><span class="o">%</span><span class="n">WDES</span><span class="o">%</span><span class="n">NCDIJ</span><span class="p">,</span><span class="n">NK</span><span class="p">,</span><span class="n">NB</span><span class="p">,</span><span class="n">NF</span><span class="p">,</span><span class="n">EFERMI</span>
</pre></div>
</div>
<p>and add the variable <code class="docutils literal notranslate"><span class="pre">EFERMI</span></code> accordingly in the function call.</p>
<ul class="simple">
<li>Vasp gets sometimes stuck and does not write the <code class="docutils literal notranslate"><span class="pre">OSZICAR</span></code> file correctly due to a stuck buffer. Adding a flush to the buffer to have a correctly written <code class="docutils literal notranslate"><span class="pre">OSZICAR</span></code> to extract the DFT energy helps, by adding in <code class="docutils literal notranslate"><span class="pre">electron.F</span></code> around line 580 after</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CALL</span> <span class="n">STOP_TIMING</span><span class="p">(</span><span class="s2">&quot;G&quot;</span><span class="p">,</span><span class="n">IO</span><span class="o">%</span><span class="n">IU6</span><span class="p">,</span><span class="s2">&quot;DOS&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>two lines:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">flush</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>
<span class="nb">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39; &#39;</span>
</pre></div>
</div>
<ul class="simple">
<li>this one is <strong>essential</strong> for the current version of the DMFT code. Vasp spends a very long time in the function <code class="docutils literal notranslate"><span class="pre">LPRJ_LDApU</span></code> and this function is not needed! It is used for some basic checks and a manual LDA+U implementation. Removing the call to this function in <code class="docutils literal notranslate"><span class="pre">electron.F</span></code> in line 644 speeds up the calculation by up to 30%! If this is not done, Vasp will create a GAMMA file each iteration which needs to be removed manually to not overwrite the DMFT GAMMA file!</li>
<li>make sure that mixing in VASP stays turned on. Don’t set IMIX or the DFT steps won’t converge!</li>
</ul>
</div>
<div class="section" id="locproj-bug-for-individual-projections">
<h2>LOCPROJ bug for individual projections:<a class="headerlink" href="#locproj-bug-for-individual-projections" title="Permalink to this headline">¶</a></h2>
<p>Example use of LOCPROJ for t2g manifold of SrVO3 (the order of the orbitals seems to be mixed up… this example leads to x^2 -y^2, z^2, yz… )
In the current version there is some mix up in the mapping between selected orbitals in the INCAR and actual selected in the LOCPROJ. This is
what the software does (left side is INCAR, right side is resulting in the LOCPROJ)</p>
<ul class="simple">
<li>xy -&gt; x2-y2</li>
<li>yz -&gt; z2</li>
<li>xz -&gt; yz</li>
<li>x2-y2 -&gt; xz</li>
<li>z2 -&gt; xy</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LOCPROJ</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">dxz</span> <span class="p">:</span> <span class="n">Pr</span> <span class="mi">1</span>
<span class="n">LOCPROJ</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">dx2</span><span class="o">-</span><span class="n">y2</span> <span class="p">:</span> <span class="n">Pr</span> <span class="mi">1</span>
<span class="n">LOCPROJ</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">dz2</span> <span class="p">:</span> <span class="n">Pr</span> <span class="mi">1</span>
</pre></div>
</div>
<p>However, if the complete d manifold is chosen, the usual VASP order (xy, yz, z2, xz, x2-y2) is obtained in the LOCPROJ. This is done as shown below</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LOCPROJ</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">d</span> <span class="p">:</span> <span class="n">Pr</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="section" id="convergence-of-projectors-with-vasp">
<h2>convergence of projectors with Vasp<a class="headerlink" href="#convergence-of-projectors-with-vasp" title="Permalink to this headline">¶</a></h2>
<p>for a good convergence of the projectors it is important to convergence the wavefunctions to high accuracy. Otherwise this often leads to off-diagonal elements in the the local Green’s function. To check convergence pay attention to the rms and rms© values in the Vasp output. The former specifies the convergence of the KS wavefunction and the latter is difference of the input and out charge density. Note, this does not necessarily coincide with good convergence of the total energy in DFT! Here an example of two calculations for the same system, both converged down to <code class="docutils literal notranslate"><span class="pre">EDIFF=</span> <span class="pre">1E-10</span></code> and Vasp stopped. First run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>       <span class="n">N</span>       <span class="n">E</span>                     <span class="n">dE</span>             <span class="n">d</span> <span class="n">eps</span>       <span class="n">ncg</span>     <span class="n">rms</span>          <span class="n">rms</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">DAV</span><span class="p">:</span>  <span class="mi">25</span>    <span class="o">-</span><span class="mf">0.394708006287E+02</span>   <span class="o">-</span><span class="mf">0.65893E-09</span>   <span class="o">-</span><span class="mf">0.11730E-10</span> <span class="mi">134994</span>   <span class="mf">0.197E-06</span>  <span class="mf">0.992E-05</span>
<span class="o">...</span>
</pre></div>
</div>
<p>second run with different smearing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">DAV</span><span class="p">:</span>  <span class="mi">31</span>    <span class="o">-</span><span class="mf">0.394760088659E+02</span>    <span class="mf">0.39472E-09</span>    <span class="mf">0.35516E-13</span> <span class="mi">132366</span>   <span class="mf">0.110E-10</span>  <span class="mf">0.245E-10</span>
<span class="o">...</span>
</pre></div>
</div>
<p>The total energy is lower as well. But more importantly the second calculation produces well converged projectors preserving symmetries way better, with less off-diagonal elements in Gloc, making it way easier for the solver. Always pay attention to rms.</p>
</div>
<div class="section" id="enabling-csc-calculations-with-wannier90-projectors">
<h2>Enabling CSC calculations with Wannier90 projectors<a class="headerlink" href="#enabling-csc-calculations-with-wannier90-projectors" title="Permalink to this headline">¶</a></h2>
<p>You basically only need to add two things to have W90 run in Vasp’s CSC mode, all in <code class="docutils literal notranslate"><span class="pre">electron.F</span></code>:</p>
<ul class="simple">
<li>the line <code class="docutils literal notranslate"><span class="pre">USE</span> <span class="pre">mlwf</span></code> at the top of the <code class="docutils literal notranslate"><span class="pre">SUBROUTINE</span> <span class="pre">ELMIN</span></code> together with all the other <code class="docutils literal notranslate"><span class="pre">USE</span> <span class="pre">...</span></code> statements.</li>
<li>right below where you removed the call to <code class="docutils literal notranslate"><span class="pre">LPRJ_LDApU</span></code> (see above, around line 650), there is the line <code class="docutils literal notranslate"><span class="pre">CALL</span> <span class="pre">LPRJ_DEALLOC_COVL</span></code>. Just add the following block right below, inside the same “if” as the <code class="docutils literal notranslate"><span class="pre">CALL</span> <span class="pre">LPRJ_DEALLOC_COVL</span></code>:</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">IF</span> <span class="p">(</span><span class="n">WANNIER90</span><span class="p">())</span> <span class="n">THEN</span>
   <span class="n">CALL</span> <span class="n">KPAR_SYNC_ALL</span><span class="p">(</span><span class="n">WDES</span><span class="p">,</span><span class="n">W</span><span class="p">)</span>
   <span class="n">CALL</span> <span class="n">MLWF_WANNIER90</span><span class="p">(</span><span class="n">WDES</span><span class="p">,</span><span class="n">W</span><span class="p">,</span><span class="n">P</span><span class="p">,</span><span class="n">CQIJ</span><span class="p">,</span><span class="n">T_INFO</span><span class="p">,</span><span class="n">LATT_CUR</span><span class="p">,</span><span class="n">INFO</span><span class="p">,</span><span class="n">IO</span><span class="p">)</span>
<span class="n">ENDIF</span>
</pre></div>
</div>
<p>Then, the only problem you’ll have is the order of compilation in the <code class="docutils literal notranslate"><span class="pre">.objects</span></code> file. It has to change because now electron.F references mlwf. For that move the entries <code class="docutils literal notranslate"><span class="pre">twoelectron4o.o</span></code> and <code class="docutils literal notranslate"><span class="pre">mlwf.o</span></code> (in this order) up right behind <code class="docutils literal notranslate"><span class="pre">linear_optics.o</span></code>. Then, move the lines from <code class="docutils literal notranslate"><span class="pre">electron.o</span></code> to <code class="docutils literal notranslate"><span class="pre">stm.o</span></code> behind the new position of <code class="docutils literal notranslate"><span class="pre">mlwf.o</span></code>.</p>
<p>Remarks:</p>
<ul class="simple">
<li>W90-CSC requires Wannier90 v3, in v2 the tag write_u_matrices does not work correctly. Until now, linking W90 v3 to Vasp with the <code class="docutils literal notranslate"><span class="pre">DVASP2WANNIER90v2</span></code> has worked without any problems even though it is not officially supported</li>
<li>symmetries in Vasp should remain turned on, otherwise the determination of rotation matrices in dft_tools’ wannier converter will most likely fail</li>
</ul>
</div>
<div class="section" id="speeding-up-by-not-writing-projectors-at-every-step">
<h2>Speeding up by not writing projectors at every step<a class="headerlink" href="#speeding-up-by-not-writing-projectors-at-every-step" title="Permalink to this headline">¶</a></h2>
<p>This is very important for CSC calculations with W90 but also speeds up the PLO-based ones.</p>
<p>Writing the Wannier projectors is a time consuming step (and to a lesser extent, the PLO projectors) and basically needs only to be done in the DFT iteration right before a DMFT iteration. Therefore, solid_dmft writes the file <code class="docutils literal notranslate"><span class="pre">vasp.suppress_projs</span></code> that tells Vasp when <strong>not</strong> to compute/write the projectors. This requires two small changes in <code class="docutils literal notranslate"><span class="pre">electron.F</span></code> in the Vasp source code:</p>
<ul class="simple">
<li>adding the definition of a logical variable where all other variables are defined for <code class="docutils literal notranslate"><span class="pre">SUBROUTINE</span> <span class="pre">ELMIN</span></code>, e.g. around line 150, by inserting <code class="docutils literal notranslate"><span class="pre">LOGICAL</span> <span class="pre">::</span> <span class="pre">LSUPPRESS_PROJS_EXISTS</span></code></li>
<li>go to the place where you removed the call to <code class="docutils literal notranslate"><span class="pre">LPRJ_LDApU</span></code> (see above, around line 650). This is inside a <code class="docutils literal notranslate"><span class="pre">IF</span> <span class="pre">(MOD(INFO%ICHARG,10)==5)</span> <span class="pre">THEN</span> <span class="pre">...</span> <span class="pre">ENDIF</span></code> block. This whole block has to be disabled when the file <code class="docutils literal notranslate"><span class="pre">vasp.suppress_projs</span></code> exists. So, right under this block’s “IF”, add the lines</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INQUIRE</span><span class="p">(</span><span class="n">FILE</span><span class="o">=</span><span class="s1">&#39;vasp.suppress_projs&#39;</span><span class="p">,</span><span class="o">&amp;</span>
        <span class="n">EXIST</span><span class="o">=</span><span class="n">LSUPPRESS_PROJS_EXISTS</span><span class="p">)</span>

<span class="n">IF</span> <span class="p">(</span><span class="o">.</span><span class="n">NOT</span><span class="o">.</span> <span class="n">LSUPPRESS_PROJS_EXISTS</span><span class="p">)</span> <span class="n">THEN</span>
</pre></div>
</div>
<p>and right before this block’s “ENDIF”, add another <code class="docutils literal notranslate"><span class="pre">ENDIF</span></code>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="docker.html" class="btn btn-neutral float-right" title="Docker" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="w90_interface.html" class="btn btn-neutral float-left" title="Wannier90 interface" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright Copyright (C) 2018-2020, ETH Zurich Copyright (C) 2021, The Simons Foundation authors: A. Hampel, M. Merkel, and S. Beck.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>